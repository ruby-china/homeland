<% if current_user && current_user.newbie? %>
<div class="card">
  <div class="card-header"><%= t("topics.newbie_tip") %></div>
  <div class="card-body">
    <%= raw Setting.newbie_notices %>
  </div>
</div>
<% else %>

<div class="card">
  <div class="card-body">
    <%= link_to t('topics.new_topic'), main_app.new_topic_path(node: @node&.id), class: 'btn btn-primary btn-block' %>
  </div>
</div>
<% end %>

<%= render "topics/sidebar_box_tips" %>

<%= raw Setting.topic_index_sidebar_html %>

<% cache(["sidebar_active_users",Time.now.strftime("%Y-%m-%d %H")]) do %>
<div class="card">
  <div class="card-header tw-flex tw-justify-between tw-text-black">
    <%= t('common.active_users') %>
    <a href="<%= main_app.users_path %>" class="tw-text-gray-400"><i class="icon fa fa-circle-info"></i></a>
  </div>
  <div class="card-body tw-grid tw-grid-cols-4 tw-gap-4">
    <% Counter.active_users(limit: 20).each do |user| %>
      <div class="tw-flex tw-flex-col gap-1">
        <%= user_avatar_tag(user, :md) %>
        <%= user_name_tag(user, class: "tw-text-sm tw-text-gray-600 tw-truncate") %>
      </div>
    <% end %>
  </div>
</div>
<% end %>

<% cache(["sidebar_statistics",Time.now.strftime("%Y-%m-%d %H")]) do %>
<div class="card">
  <div class="card-header"><%= t("common.statics")%></div>
  <ul class="list-group list-group-flush">
    <li class="list-group-item"><%= t("common.statics_users_count", count: User.unscoped.count) %></li>
    <li class="list-group-item"><%= t("common.statics_topics_count", count: Topic.unscoped.count) %></li>
    <li class="list-group-item"><%= t("common.statics_replies_count", count: Reply.unscoped.count) %></li>
  </ul>
</div>
<% end %>
